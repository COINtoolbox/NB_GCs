ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err))+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH))+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err))+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH))
CairoPDF("MBH.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err))+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH))+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err))+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH))+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
CairoPDF("MBH.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err))+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH))+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("MBH.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err))+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH),width=0.2)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("MBH.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err))+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH),width=.5)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("MBH.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),width=.5)+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH),width=.5)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("MBH.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),width=.2)+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH),width=.5)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("MBH.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),width=.15)+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH),width=.5)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("MBH.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),width=.125)+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH),width=.5)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("MBH.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),width=.12,alpha=0.7)+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH),width=.5,alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
CairoPDF("MBH.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MBH,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
geom_errorbarh(aes(xmin=MBH-GCS$lowMBH,
xmax=MBH+upMBH),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_stata()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[BH]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
GCS[1,]
ggplot(GCS,aes(x=Mdyn,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[dyn]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
CairoPDF("Mdyn.pdf",height=8,width=9)
ggplot(GCS,aes(x=Mdyn,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[dyn]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("Mdyn.pdf",height=8,width=9)
ggplot(GCS,aes(x=Mdyn,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(log~M[dyn]/M['\u0298']))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("sig_e.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=sig_e,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(sigma[e]*(km/s)))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("Re.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=Re,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(R[e]*(kpc)))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("MV.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MV_T,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(M[V]))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))+
scale_x_reverse()
dev.off()
CairoPDF("MK.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=MK,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(M[K]))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))+
scale_x_reverse()
dev.off()
GCS[1,]
CairoPDF("sig_e.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=sig_e,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
geom_errorbarh(aes(xmin=sig_e-err_sig_e,
xmax=sig_e+err_sig_e),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(sigma[e]*(km/s)))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("sig_e.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=sig_e,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
geom_errorbarh(aes(xmin=sig_e-err_sig_e,
xmax=sig_e+err_sig_e),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(sigma[e]~(km/s)))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("Re.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=Re,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(R[e]~(kpc)))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
CairoPDF("sig_e.pdf",height=8,width=9,family="Symbol")
ggplot(GCS,aes(x=sig_e,y=N_GC,colour=Type,shape=Type))+geom_point(size=3)+
geom_errorbar(guide="none",aes(ymin=N_GC-N_err,ymax=N_GC+N_err),alpha=0.7)+
geom_errorbarh(aes(xmin=sig_e-err_sig_e,
xmax=sig_e+err_sig_e),alpha=0.7)+
scale_y_continuous(trans = 'log10',
breaks=trans_breaks("log10",function(x) 10^x),
labels=trans_format("log10",math_format(10^.x)))+
scale_colour_tableau()+scale_shape_tremmel()+
theme_economist_white(gray_bg = F, base_size = 11, base_family = "sans")+
ylab(expression(N[GC]))+
xlab(expression(sigma~(km/s)))+theme(plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=25))
dev.off()
GCS$logN_GC = GCS$N_GC
ggplot(GCS, aes(x = MBH, y = logN_GC)) +
#  scale_y_continuous(trans = 'log10',
#                     breaks=trans_breaks("log10",function(x) 10^x),
#                     labels=trans_format("log10",math_format(10^.x)))+
geom_point() +
geom_line(data=P, aes(x = MBH, y=logN_GC, colour=model)) +
geom_ribbon(data=P, aes(ymin=lwr, ymax=upr, fill=model), alpha=0.5) +
facet_wrap(~ model, ncol=1)+scale_color_tableau()+scale_linetype_stata()+
scale_fill_tableau()+
theme_economist_white(gray_bg = T, base_size = 10, base_family = "sans")+
theme(legend.text=element_text(size=8),legend.position="right",plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=10))
summary(colMeans(Blinm) - linmPred)
summary(colMeans(Bpois) - poisPred)
summary(colMeans(Bnegb) - negbPred)
# Now plot predicted means and prediction intervals
P = MBHx
P$linm = linmPred
P$pois = poisPred
P$negb = negbPred
P = melt(P, id.vars = "MBH", variable_name = "model")
names(P)[3] = "logN_GC"
P$lwr = c(colMeans(BlinmL), colMeans(BpoisL), colMeans(BnegbL))
P$upr = c(colMeans(BlinmU), colMeans(BpoisU), colMeans(BnegbU))
N = nrow(GCS)
# predN = 50
# MBHx = data.frame(MBH = seq(from = 0.9 * min(GCS$MBH),
#                             to = 1.1 * max(GCS$MBH),
#                             length.out = predN))
# Do the following instead, to enable calculation of coverage.
MBHx = data.frame(MBH = GCS$MBH)
predN = length(GCS$MBH)
bN = 1000
Blinm = Bpois = Bnegb = matrix(data = NA, nrow = bN, ncol = predN)
BlinmU = BlinmL = BpoisU = BpoisL = BnegbU = BnegbL = Blinm
qlwr = 0.025
qupr = 0.975
for (i in 1:bN) {
G = GCS[sample(1:N, N, replace = TRUE),]
#  linmFit = glm(log(N_GC) ~ MBH, G, family="gaussian")
linmFit = lm(log(N_GC) ~ MBH, G)
poisFit = glm(N_GC ~ MBH, G, family="poisson")
negbFit = glm.nb(N_GC ~ MBH, G)
linmP = predict(linmFit, MBHx)
poisP = predict(poisFit, MBHx)
negbP = predict(negbFit, MBHx)
Blinm[i,] = linmP
BlinmL[i,] = qnorm(qlwr, mean = linmP, sd = sd(residuals(linmFit)))
BlinmU[i,] = qnorm(qupr, mean = linmP, sd = sd(residuals(linmFit)))
Bpois[i,] = poisP
BpoisL[i,] = log(qpois(qlwr, lambda = exp(poisP)))
BpoisU[i,] = log(qpois(qupr, lambda = exp(poisP)))
Bnegb[i,] = negbP
BnegbL[i,] = log(qnbinom(qlwr, size = negbFit$theta, mu = exp(negbP)))
BnegbU[i,] = log(qnbinom(qupr, size = negbFit$theta, mu = exp(negbP)))
}
# fit once more, on the full sample, as a reference:
linmFit = glm(log(N_GC) ~ MBH, GCS, family="gaussian")
poisFit = glm(N_GC ~ MBH, GCS, family="poisson")
negbFit = glm.nb(N_GC ~ MBH, GCS)
linmPred = predict(linmFit, MBHx)
poisPred = predict(poisFit, MBHx)
negbPred = predict(negbFit, MBHx)
summary(colMeans(Blinm) - linmPred)
summary(colMeans(Bpois) - poisPred)
summary(colMeans(Bnegb) - negbPred)
P = MBHx
P$linm = linmPred
P$pois = poisPred
P$negb = negbPred
P = melt(P, id.vars = "MBH", variable_name = "model")
names(P)[3] = "logN_GC"
P$lwr = c(colMeans(BlinmL), colMeans(BpoisL), colMeans(BnegbL))
P$upr = c(colMeans(BlinmU), colMeans(BpoisU), colMeans(BnegbU))
GCS$logN_GC = GCS$N_GC
ggplot(GCS, aes(x = MBH, y = logN_GC)) +
#  scale_y_continuous(trans = 'log10',
#                     breaks=trans_breaks("log10",function(x) 10^x),
#                     labels=trans_format("log10",math_format(10^.x)))+
geom_point() +
geom_line(data=P, aes(x = MBH, y=logN_GC, colour=model)) +
geom_ribbon(data=P, aes(ymin=lwr, ymax=upr, fill=model), alpha=0.5) +
facet_wrap(~ model, ncol=1)+scale_color_tableau()+scale_linetype_stata()+
scale_fill_tableau()+
theme_economist_white(gray_bg = T, base_size = 10, base_family = "sans")+
theme(legend.text=element_text(size=8),legend.position="right",plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=10))
GCS$logN_GC = GCS$N_GC
ggplot(GCS, aes(x = MBH, y = logN_GC)) +
#  scale_y_continuous(trans = 'log10',
#                     breaks=trans_breaks("log10",function(x) 10^x),
#                     labels=trans_format("log10",math_format(10^.x)))+
geom_point() +
geom_line(data=P, aes(x = MBH, y=logN_GC, colour=model)) +
geom_ribbon(data=P, aes(ymin=lwr, ymax=upr, fill=model), alpha=0.5) +
facet_wrap(~ model, ncol=1)+scale_color_tableau()+scale_linetype_stata()+
scale_fill_tableau()+
theme_economist_white(gray_bg = T, base_size = 10, base_family = "sans")+
theme(legend.text=element_text(size=8),legend.position="right",plot.title = element_text(hjust=0.5),
axis.title.y=element_text(vjust=0.75),
axis.title.x=element_text(vjust=-0.25),
text = element_text(size=10))
